<h3 class="page-header col-md-12">点评技师</h3>

<div class="col-md-7">
  <%= bootstrap_simple_form_for([ :merchants, @order ]) do |f| %>
    <%= f.error_messages %>

    <%= f.input :professionality do %>
      <div class="stars">
        <% @order.professionality.times do %>
          <span class="glyphicon glyphicon-star"></span>
        <% end %>
        <% (5 - @order.professionality).times do %>
          <span class="glyphicon glyphicon-star-empty"></span>
        <% end %>
        <%= f.hidden_field :professionality %>
      </div>
    <% end %>
    <%= f.input :timeliness do %>
      <div class="stars">
        <% @order.timeliness.times do %>
          <span class="glyphicon glyphicon-star"></span>
        <% end %>
        <% (5 - @order.timeliness).times do %>
          <span class="glyphicon glyphicon-star-empty"></span>
        <% end %>
        <%= f.hidden_field :timeliness %>
      </div>
    <% end %>
    <%= f.input :review, input_html: { rows: 4 } %>

    <%= f.button :submit, "确定", class: "btn-primary pull-right" %>
  <% end %>
</div>

<script type="text/javascript">
  var elements = document.querySelectorAll(".stars .glyphicon");
  for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener("click", function(event) {
      var icons = this.parentElement.querySelectorAll(".glyphicon");
      var value = Array.prototype.indexOf.call(icons, this) + 1;
      this.parentElement.querySelector("input[type=hidden]").value = value;
      var shownIcons = Array.prototype.slice.call(icons, 0, value);
      var hiddenIcons = Array.prototype.slice.call(icons, value, icons.length);
      for (var j = shownIcons.length - 1; j >= 0; j--) {
        shownIcons[j].classList.remove("glyphicon-star-empty");
        shownIcons[j].classList.add("glyphicon-star");
      }
      for (var j = hiddenIcons.length - 1; j >= 0; j--) {
        hiddenIcons[j].classList.add("glyphicon-star-empty");
        hiddenIcons[j].classList.remove("glyphicon-star");
      }
    });
  }
</script>
