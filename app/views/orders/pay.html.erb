<%= link_to "wechat_payment_btn", "javascript:void(0)", id: "wechat_payment_btn" %>

<script type="text/javascript">
  var orderParams = {
    appId:     "<%= @order_params[:app_id] %>",
    timeStamp: "<%= @order_params[:timestamp] %>",
    nonceStr:  "<%= @order_params[:nonce_str] %>",
    package:   "<%= @order_params[:package] %>",
    paySign:   "<%= @order_params[:pay_sign] %>",
    signType:  "<%= @order_params[:sign_type] %>"
  };
  document.addEventListener('WeixinJSBridgeReady', function () {
    wechat_payment_btn.addEventListener("click", function() {
      WeixinJSBridge.invoke('getBrandWCPayRequest', orderParams, function(res) {
        if (res.err_msg == "get_brand_wcpay_request:ok") {
          alert('pay for success!');
        } else {
          alert(res.err_msg);
        }
      });
    });
  }, false);
</script>
